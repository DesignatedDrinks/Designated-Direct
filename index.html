<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Designated Direct - Variety Packs</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 20px auto;
        padding: 0 20px;
      }
      .filter-container {
        margin-bottom: 20px;
      }
      .pack-item {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
      }
      .pack-item img {
        max-width: 100%;
        height: auto;
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>Choose a Variety Pack</h1>
    <!-- Dropdown for Pack Titles -->
    <div class="filter-container">
      <label for="packDropdown">Select Variety Pack: </label>
      <select id="packDropdown">
        <option value="All">All</option>
      </select>
    </div>
    
    <!-- Detailed results from "Variety Packs" tab -->
    <div id="results">Loading data...</div>
    
    <script>
      // Google Sheet details
      const spreadsheetId = '1TtRNmjsgC64jbkptnCdklBf_HqifwE9SQO2JlGrp4Us';
      const apiKey = 'AIzaSyDx9DhE2lC8WwDp0VLAihrPoiYwMLyPSZE';
      
      // URL for "Pack Titles" tab (titles in Column A, rows 2+)
      const packTitlesRange = "Pack Titles!A2:A";
      const packTitlesURL = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(packTitlesRange)}?key=${apiKey}`;
      
      // URL for "Variety Packs" tab (detailed data in Columns A–C, rows 2–1000)
      const varietyPacksRange = "Variety Packs!A2:C1000";
      const varietyPacksURL = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(varietyPacksRange)}?key=${apiKey}`;
      
      // Global variable to store detailed variety packs data
      let varietyPacksData = [];
      
      // Function to display detailed data filtered by pack title
      function displayData(filterTitle) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';
        
        // Filter data if a specific title is selected
        let filteredData = varietyPacksData;
        if (filterTitle !== 'All') {
          filteredData = varietyPacksData.filter(row => row[0].trim() === filterTitle);
        }
        
        if (filteredData.length === 0) {
          resultsDiv.textContent = 'No entries found for this variety pack.';
          return;
        }
        
        // Create an element for each entry
        filteredData.forEach(row => {
          const [packTitle, beerName, beerImageURL] = row;
          const packDiv = document.createElement('div');
          packDiv.classList.add('pack-item');
          packDiv.innerHTML = `<h3>${packTitle} - ${beerName}</h3>
                               <img src="${beerImageURL}" alt="${beerName}">`;
          resultsDiv.appendChild(packDiv);
        });
      }
      
      // Fetch both datasets concurrently
      Promise.all([
        fetch(packTitlesURL).then(response => response.json()),
        fetch(varietyPacksURL).then(response => response.json())
      ])
      .then(([packTitlesResponse, varietyPacksResponse]) => {
        console.log("Pack Titles Response:", packTitlesResponse);
        console.log("Variety Packs Response:", varietyPacksResponse);
        
        const packDropdown = document.getElementById('packDropdown');
        
        // Populate dropdown with titles from "Pack Titles" tab
        if (packTitlesResponse.values && packTitlesResponse.values.length > 0) {
          packTitlesResponse.values.forEach(row => {
            const title = row[0];
            const option = document.createElement('option');
            option.value = title;
            option.textContent = title;
            packDropdown.appendChild(option);
          });
        } else {
          console.warn("No data found in 'Pack Titles' tab.");
        }
        
        // Store detailed variety packs data from "Variety Packs" tab
        if (varietyPacksResponse.values && varietyPacksResponse.values.length > 0) {
          varietyPacksData = varietyPacksResponse.values;
        } else {
          document.getElementById('results').textContent = 'No variety pack data found.';
          return;
        }
        
        // Initially display all entries
        displayData('All');
        
        // Update displayed data when dropdown selection changes
        packDropdown.addEventListener('change', function() {
          displayData(this.value);
        });
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        document.getElementById('results').textContent = 'Failed to load data.';
      });
    </script>
  </body>
</html>
